<%- include('../layouts/admin/header.ejs') %>
<style>
  .image-preview-container {
  display: flex;
  flex-wrap: wrap;
  gap: 10px; /* Adjust the spacing between previews */
}

.preview-wrapper {
  position: relative;
  width: 100px; /* Set the desired width for previews */
  height: 100px; /* Set the desired height for previews */
  overflow: hidden; /* Hide overflow to ensure the image fits within the wrapper */
}

.preview-img {
  width: 100%; /* Ensure the image fits the wrapper width */
  height: 100%; /* Ensure the image fits the wrapper height */
  object-fit: cover; /* Cover the wrapper while preserving the aspect ratio */
}

.delete-btn {
  position: absolute;
  top: 5px; /* Adjust the position as needed */
  right: 5px; /* Adjust the position as needed */
  background: red;
  color: white;
  border: none;
  border-radius: 50%;
  cursor: pointer;
  padding: 2px 5px;
}
  
</style>

  <body class="g-sidenav-show  bg-gray-200">

    <aside
    class="sidenav navbar navbar-vertical navbar-expand-xs border-0 border-radius-xl my-3 fixed-start ms-3   bg-gradient-dark"
    id="sidenav-main">
    <div class="sidenav-header" style="margin: 15px;">
      <i class="fas fa-times p-3 cursor-pointer text-white opacity-5 position-absolute end-0 top-0 d-none d-xl-none"
        aria-hidden="true" id="iconSidenav"></i>
      <a class="navbar-brand m-0" href=" https://demos.creative-tim.com/material-dashboard/pages/dashboard "
        target="_blank"></a>
      <img src="/public/assets/images/icons/sacecart-01 1.png" class="navbar-brand-img h-100" alt="main_logo">
      <span class="ms-1 font-weight-bold text-white">Material Dashboard</span>
      </a>
    </div>
    <hr class="horizontal light mt-0 mb-2">
    <!-- <div class="collapse navbar-collapse  w-auto  max-height-vh-100" id="sidenav-collapse-main"> --> 
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link " href="/admin/home">
          <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
            <i class="material-icons opacity-10">dashboard</i>
          </div>
          <span class="nav-link-text ms-1">Dashboard</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link text-white " href="/admin/view-users">
          <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
            <i class="material-icons opacity-10">group</i>
          </div>
          <span class="nav-link-text ms-1">Users</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link text-white " href="/admin/view-category">
          <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
            <i class="material-icons opacity-10">inventory_2</i>
          </div>
          <span class="nav-link-text ms-1">Category</span>
        </a>
      </li>

      <li class="nav-item">
        <a class="nav-link text-white active bg-gradient-primary" href="/admin/view-product">
          <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
            <i class="material-icons opacity-10">branding_watermark</i>
          </div>
          <span class="nav-link-text ms-1">products</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link text-white " href="/admin/view-brand">
          <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
            <i class="material-icons opacity-10">category</i>
          </div>
          <span class="nav-link-text ms-1">Brand</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link text-white " href="/admin/view-orders">
          <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
            <i class="material-icons opacity-10">wysiwyg</i>
          </div>
          <span class="nav-link-text ms-1">Orders</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link text-white " href="/admin/view-coupon">
          <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
            <i class="material-icons opacity-10">redeem</i>
          </div>
          <span class="nav-link-text ms-1">Coupon</span>
        </a>
      </li>
      <li class="nav-item mt-3">
        <h6 class="ps-4 ms-2 text-uppercase text-xs text-white font-weight-bolder opacity-8">Account pages
        </h6>
      </li>
      <li class="nav-item">
        <a class="nav-link text-white " href="./pages/profile.html">
          <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
            <i class="material-icons opacity-10">person</i>
          </div>
          <span class="nav-link-text ms-1">Profile</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link text-white " href="/admin/logout">
          <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
            <i class="material-icons opacity-10">logout</i>
          </div>
          <span class="nav-link-text ms-1">Log out</span>
        </a>
      </li>
      <!-- <li class="nav-item">
<a class="nav-link text-white " href="./pages/sign-up.html">
  <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
    <i class="material-icons opacity-10">assignment</i>
  </div>
  <span class="nav-link-text ms-1">Sign Up</span>
</a>
</li> -->
    </ul>
    <!-- </div> -->
    <!-- <div class="sidenav-footer position-absolute w-100 bottom-0 ">
<div class="mx-3">
<a class="btn bg-gradient-primary mt-4 w-100" href="https://www.creative-tim.com/product/material-dashboard-pro?ref=sidebarfree" type="button">Upgrade to pro</a>
</div>
</div> -->
  </aside>      <main class="main-content position-relative max-height-vh-100 h-100 border-radius-lg ">

        <%- include('../layouts/admin/navbar.ejs') %>

        <div class="container-fluid py-4">
          <div class="row">
            <div class="col-12">
              <!-- Card Section -->
              <div class="card my-4">
                <!-- Card Header -->
                <div class="card-header p-0 position-relative mt-n4 mx-3 z-index-2">
                  <div class="bg-gradient-primary shadow-primary border-radius-lg pt-4 pb-3">
                    <h6 class="text-white text-capitalize ps-3">
                      <%=message%>
                    </h6>
                  </div>
                </div>
        
                <!-- Card Body -->
                <div class="card-body px-0 pb-2">
                  <div class="container-fluid">
                    <!-- Edit Product Form -->
                    <form action="/admin/edit-product" enctype="multipart/form-data" method="post" id="editProductForm">
                      <div class="row">
                        <div class="col-md-3 py-4">
                          <div class="form-group">
                            <div class="form-label rounded">Product Name</div>
                            <input type="text" value="<%= productData.name %>" name="productName" id="productName" placeholder="Product Name" required>
                            <div id="productNameError" class="error-message text-danger"></div>
                          </div>
                        </div>
                    
                        <div class="col-md-3 py-4">
                          <div class="form-group">
                            <div class="form-label rounded">Category Name</div>
                            <select id="category" name="category" required>
                              <% category.forEach(cat => { %>
                                <option value="<%= cat._id %>" <%= productData.category.equals(cat._id) ? 'selected' : '' %>>
                                  <%= cat.categoryName %>
                                </option>
                              <% }); %>
                            </select>
                            <div id="categoryError" class="error-message text-danger"></div>
                          </div>
                        </div>
                    
                        <div class="col-md-3 py-4">
                          <div class="form-group">
                            <div class="form-label rounded">Brand</div>
                            <select id="brand" name="brand" required>
                              <% brandData.forEach(brand => { %>
                                <option value="<%= brand._id %>" <%= productData.brandName.equals(brand._id) ? 'selected' : '' %>>
                                  <%= brand.brandName %>
                                </option>
                              <% }); %>
                            </select>
                            <div id="brandError" class="error-message text-danger"></div>
                          </div>
                        </div>
                    
                        <div class="col-md-3 py-4">
                          <div class="form-group">
                            <div class="form-label rounded">Quantity</div>
                            <input type="number" value="<%= productData.qty %>" name="qty" placeholder="Quantity" required>
                            <div id="qtyError" class="error-message text-danger"></div>
                          </div>
                        </div>
                    
                        <div class="col-md-3 py-4">
                          <div class="form-group">
                            <div class="form-label rounded">Specification</div>
                            <input type="text" value="<%= productData.description %>" name="description" placeholder="Description" required>
                            <div id="descriptionError" class="error-message text-danger"></div>
                          </div>
                        </div>
                    
                        <div class="col-md-3 py-4">
                          <div class="form-group">
                            <div class="form-label rounded">Price</div>
                            <input type="text" value="<%= productData.price %>" name="price" placeholder="Price" required>
                            <div id="priceError" class="error-message text-danger"></div>
                          </div>
                        </div>
                    
                        <div class="col-md-3 py-4">
                          <div class="form-group">
                            <div class="form-label rounded">New Image</div>
                            <% productData.image.forEach(img => { %>
                              <img src="/public/userImages/<%= img %>" alt="Old Image" style="width: 100px;">
                            <% }); %>
                          <!-- Image input and preview container -->
                        <input type="file" name="image" id="image" multiple accept="image/*">
                        <div class="image-preview-container my-2">
                          <!-- Previews will be injected here by JavaScript -->
                        </div>

                            <div id="imageError" class="error-message text-danger"></div>
                          </div>
                        </div>
                        
                    
                        <div class="col-md-3 py-4">
                          <input type="hidden" name="id" value="<%= productData._id %>">
                          <div class="form-check py-4">
                            <div class="form-label rounded">Action</div>
                            <input class="form-check-input" type="radio" name="is_active" value="1" <%= productData.is_active ? 'checked' : '' %>>
                            <label class="form-check-label" for="flexRadioDefault1">List</label>
                          </div>
                          <div class="form-check">
                            <input class="form-check-input" type="radio" name="is_active" value="0" <%= !productData.is_active ? 'checked' : '' %>>
                            <label class="form-check-label" for="flexRadioDefault2">Unlist</label>
                          </div>
                          <button type="submit" class="btn btn-primary">Update</button>
                        </div>
                      </div>
                    </form>
                    
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- Include Footer -->
          <%- include('../layouts/admin/footer.ejs') %>
        </div>
        

      <!-- </div> -->
                            <!-- <div class="form-check py-4">
                              <div class="form-label rounded">Action</div>
                              <input class="form-check-input" type="radio" name="is_active" value="1" <%
                                if(productData.is_active==true){%> checked <%}%> >
                                <label class="form-check-label" for="flexRadioDefault1">List</label>
                            </div>
                            <div class="form-check">
                              <input class="form-check-input" type="radio" name="is_active" value="0" <%
                                if(productData.is_active==false){%> id="flexRadioDefault2" checked <%}%> >
                                <label class="form-check-label" for="flexRadioDefault2">Unlist</label>
                            </div>
                          </div> -->
      </main>
     
      <script>
        document.getElementById("image").addEventListener("change", function (event) {
          const files = event.target.files;
          const previewContainer = document.querySelector(".image-preview-container");
  
          // Clear any existing previews
          previewContainer.innerHTML = "";
  
          // Loop through each selected file
          Array.from(files).forEach((file, index) => {
            const reader = new FileReader();
  
            reader.onload = function (e) {
              const previewWrapper = document.createElement("div");
              previewWrapper.className = "preview-wrapper";
  
              const img = document.createElement("img");
              img.src = e.target.result;
              img.className = "preview-img";
  
              const deleteButton = document.createElement("button");
              deleteButton.textContent = "Delete";
              deleteButton.className = "delete-btn";
              deleteButton.addEventListener("click", function () {
                previewWrapper.remove();
                // Optionally remove the file from the input (not implemented here)
              });
  
              previewWrapper.appendChild(img);
              previewWrapper.appendChild(deleteButton);
              previewContainer.appendChild(previewWrapper);
            };
  
            reader.readAsDataURL(file);
          });
        });
      </script>

      <script>
        function validateForm() {
          return (
            validateProductName() &&
            validateCategory() &&
            validateBrand() &&
            validateQuantity() &&
            validateDescription() &&
            validatePrice() &&
            validateImage()
            // Add calls to other validation functions
          );
        }
      
        function validateProductName() {
          const productName = document.getElementById('productName').value.trim();
          const regex = /^[a-zA-Z\s]*$/; // Regular expression to match only letters and spaces
      
          if (!regex.test(productName)) {
            document.getElementById('productNameError').textContent = 'Product name should contain only letters and spaces.';
            return false;
          }
      
          if (productName.length < 3) {
            document.getElementById('productNameError').textContent = 'Product name must be at least 3 characters long.';
            return false;
          }
      
          return true;
        }
      
        function validateCategory() {
          const category = document.getElementById('category').value;
          return validateField(category, 'categoryError', 'Please choose a category.');
        }
      
        function validateBrand() {
          const brand = document.getElementById('brand').value;
          return validateField(brand, 'brandError', 'Please choose a brand.');
        }
      
        function validateQuantity() {
  const quantity = document.getElementsByName('qty')[0].value.trim();

  if (isNaN(quantity) || parseInt(quantity) < 0) {
    document.getElementById('qtyError').textContent = 'Quantity must be a non-negative numeric value.';
    return false;
  }

  return validateField(quantity, 'qtyError', 'Quantity must be a numeric value.');
}
  

      
        function validateDescription() {
          const description = document.getElementById('description').value.trim();
          return validateField(description, 'descriptionError', 'Description cannot be empty.');
        }
      
        function validatePrice() {
          const price = document.getElementById('price').value;
          return validateField(price, 'priceError', 'Price must be a numeric value.');
        }
      
        function validateImage() {
          const image = document.getElementById('image').value;
          return validateField(image, 'imageError', 'Please upload an image.');
        }
      
        function validateField(value, errorId, errorMessage) {
          const errorElement = document.getElementById(errorId);
          errorElement.textContent = '';
      
          if (!value) {
            errorElement.textContent = errorMessage;
            return false;
          }
      
          return true;
        }
      
        document.getElementById('editProductForm').addEventListener('submit', function(event) {
          if (!validateForm()) {
            event.preventDefault();
          }
        });
      </script>
      
    
    