<%- include('../layouts/user/header.ejs') -%>
  <main class="main">
    <div class="page-header text-center"
      style="background-image: url('/public/userAssets/assets/images/page-header-bg.jpg')">
      <div class="container">
        <h1 class="page-title">Shop<span> Elevating Style, One Step at a Time</span></h1>
      </div><!-- End .container -->
    </div><!-- End .page-header -->
    <nav aria-label="breadcrumb" class="breadcrumb-nav mb-2">
      <div class="container">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="/">Home</a></li>
          <li class="breadcrumb-item"><a href="/shop">Shop</a></li>

        </ol>
      </div><!-- End .container -->
    </nav><!-- End .breadcrumb-nav -->

    <div class="page-content">
      <div class="container">
        <div class="row">
          <div class="col-lg-9">
            <div class="toolbox">
              <div class="toolbox-left">
                <div class="toolbox-info">
                  Showing <span>9 of 56</span> Products
                </div><!-- End .toolbox-info -->
              </div><!-- End .toolbox-left -->

              <div class="toolbox-right">
                <div class="toolbox-sort">
                  <label for="sortby">Sort by:</label>
                  <div class="select-custom">
                    <select name="sortby" id="sortby" class="form-control">
                      <option value="popularity" selected="selected">Most Popular</option>
                      <option value="rating">Most Rated</option>
                      <option value="date">Date</option>
                    </select>
                  </div>
                </div><!-- End .toolbox-sort -->
                <div class="toolbox-layout">
                  <a href="category-list.html" class="btn-layout">
                    <svg width="16" height="10">
                      <rect x="0" y="0" width="4" height="4" />
                      <rect x="6" y="0" width="10" height="4" />
                      <rect x="0" y="6" width="4" height="4" />
                      <rect x="6" y="6" width="10" height="4" />
                    </svg>
                  </a>

                  <a href="category-2cols.html" class="btn-layout">
                    <svg width="10" height="10">
                      <rect x="0" y="0" width="4" height="4" />
                      <rect x="6" y="0" width="4" height="4" />
                      <rect x="0" y="6" width="4" height="4" />
                      <rect x="6" y="6" width="4" height="4" />
                    </svg>
                  </a>

                  <a href="category.html" class="btn-layout">
                    <svg width="16" height="10">
                      <rect x="0" y="0" width="4" height="4" />
                      <rect x="6" y="0" width="4" height="4" />
                      <rect x="12" y="0" width="4" height="4" />
                      <rect x="0" y="6" width="4" height="4" />
                      <rect x="6" y="6" width="4" height="4" />
                      <rect x="12" y="6" width="4" height="4" />
                    </svg>
                  </a>

                  <a href="category-4cols.html" class="btn-layout active">
                    <svg width="22" height="10">
                      <rect x="0" y="0" width="4" height="4" />
                      <rect x="6" y="0" width="4" height="4" />
                      <rect x="12" y="0" width="4" height="4" />
                      <rect x="18" y="0" width="4" height="4" />
                      <rect x="0" y="6" width="4" height="4" />
                      <rect x="6" y="6" width="4" height="4" />
                      <rect x="12" y="6" width="4" height="4" />
                      <rect x="18" y="6" width="4" height="4" />
                    </svg>
                  </a>
                </div><!-- End .toolbox-layout -->
              </div><!-- End .toolbox-right -->
            </div><!-- End .toolbox -->

            <div class="products mb-3">
              <div class="row justify-content-center">
                <% for(i=0;i<products.length;i++) {%>
                  <div class="col-6 col-md-4 col-lg-4 col-xl-3 product-item" data-brand="<%= products[i].brandName %>" data-category="<%= products[i].category %>">
                    <div class="product product-7 text-center">
                      <figure class="product-media">
                        <a href="/product?id=<%= products[i]._id%>">
                          <img src="/public/userImages/<%= products[i].image %>" alt="Product image"
                            class="product-image">
                          <img src="/public/userImages/<%= products[i].image %>" alt="Product image"
                            class="product-image-hover">
                        </a>

                        <div class="product-action-vertical">
                          <a href="#" style="cursor: pointer;"
                            onclick="addtoWishList('<%= products[i]._id %>','<%= user %>')"
                            class="btn-product-icon btn-wishlist "><span>add to wishlist</span></a>
                        </div><!-- End .product-action-vertical -->
                      </figure><!-- End .product-media -->

                      <div class="product-body">
                        <div class="product-cat">
                          <a rel="tag" style="font-size: 14px;">
                            <%= products[i].gender%>
                          </a>,
                          <a rel="tag" style="font-size: 14px;">
                            <%= products[i].category %>
                          </a>
                        </div>
                        <h3 class="product-title"><a>
                            <%= products[i].product_name %>
                          </a></h3><!-- End .product-title -->
                        <div class="product-price">
                          â‚¹<%= products[i].price %>
                        </div><!-- End .product-price -->
                      </div><!-- End .product-body -->
                      <div class="product-action">
                        <a class="btn-product btn-cart" onclick="addToCart('<%= products[i]._id %>')" id="addToCartBtn_<%= products[i]._id %>">
                            <span>add to cart</span>
                        </a>
                    </div><!-- End .product-action -->
                    </div><!-- End .product -->
                  </div><!-- End .col-sm-6 col-md-4 col-lg-3 -->

                  <%}%>
              </div>
            </div>





            <div class="store-filter clearfix">
              <ul class="pagination justify-content-center">
            
                <% for (let i = 1; i <= totalPages; i++) { %>
                  <% if (currentPage == i) { %>
                    <li class="page-item active"><a class="page-link" href="?page=<%= i %>"><%= i %></a></li>
                  <% } else { %>
                    <li class="page-item"><a class="page-link" href="?page=<%= i %>"><%= i %></a></li>
                  <% } %>
                <% }; %>
            
              </ul>
            </div>
            
          </div><!-- End .col-lg-9 -->
          <aside class="col-lg-3 order-lg-first">
            <div class="sidebar sidebar-shop">
              <div class="widget widget-clean">
                <label>Filters:</label>
                <a href="#" class="sidebar-filter-clear">Clean All</a>
              </div><!-- End .widget widget-clean -->

              <div class="widget widget-collapsible">
                <h3 class="widget-title">
                  <a data-toggle="collapse" href="#widget-1" role="button" aria-expanded="true"
                    aria-controls="widget-1">
                    Category
                  </a>
                </h3><!-- End .widget-title -->

                <div class="collapse show" id="widget-1">
                  <div class="widget-body">
                    <div class="filter-items filter-items-count">
                      <% categoryData.forEach((category, index) =>{%>
                        <div class="checkbox-filter">
                            <div class="input-checkbox">
                                <input type="checkbox" id="category-<%=index+1%>">
                                <label for="category-<%=index+1%>">
                                    <span></span>
                                    <%=category.categoryName%>
                                    <!-- <small>(120)</small> -->
                                </label>    
                            </div>
                        </div>
                        <% }); %>

                      
                    </div><!-- End .filter-items -->
                  </div><!-- End .widget-body -->
                </div><!-- End .collapse -->
              </div><!-- End .widget -->

              

              

              <div class="widget widget-collapsible">
                <h3 class="widget-title">
                  <a data-toggle="collapse" href="#widget-4" role="button" aria-expanded="true"
                    aria-controls="widget-4">
                    Brand
                  </a>
                </h3><!-- End .widget-title -->

                <div class="collapse show" id="widget-4">
                  <div class="widget-body">
                    <div class="filter-items">

                      <% brandData.forEach((brand, index)=>{%>
                        <div class="checkbox-filter">
                            <div class="input-checkbox">
                                <input type="checkbox" id="brand-<%=index+1%>" class="brand-checkbox">
                                <label for="brand-<%=index+1%>">
                                    <span></span>
                                    <%=brand.brandName%>
                                    <!-- <small>(578)</small> -->
                                </label>
                            </div>
                        </div>
                        <% }); %>
                      
                    </div><!-- End .filter-items -->
                  </div><!-- End .widget-body -->
                </div><!-- End .collapse -->
              </div><!-- End .widget -->
            </div><!-- End .sidebar sidebar-shop -->
          </aside><!-- End .col-lg-3 -->
        </div><!-- End .row -->
      </div><!-- End .container -->
    </div><!-- End .page-content -->
  </main><!-- End .main -->


  <%- include('../layouts/user/footer.ejs') -%>


   
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  <script src="/path/to/script.js"></script>
  <!-- Include SweetAlert library -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>




  <script>
    $(document).ready(function () {
        // Store the initial state of products
        const initialProducts = $('.product-item');
    
        // Attach a click event handler to brand checkboxes
        $('.brand-checkbox').on('change', function () {
            updateProductDisplay();
        });
    
        // Attach a click event handler to category checkboxes
        $('[id^="category-"]').on('change', function () {
            updateProductDisplay();
        });
    
        // Function to update the product display based on selected filters
        function updateProductDisplay() {
            // Get the selected brands
            const selectedBrands = $('.brand-checkbox:checked').map(function () {
                return $(this).siblings('label').text().trim();
            }).get();
    
            // Get the selected categories
            const selectedCategories = $('[id^="category-"]:checked').map(function () {
                return $(this).siblings('label').text().trim();
            }).get();
    
            // Filter products based on selected brands and categories
            if (selectedBrands.length > 0 || selectedCategories.length > 0) {
                initialProducts.hide();
    
                initialProducts.each(function () {
                    const productBrand = $(this).data('brand');
                    const productCategory = $(this).data('category');
    
                    if (
                        (selectedBrands.length === 0 || selectedBrands.includes(productBrand)) &&
                        (selectedCategories.length === 0 || selectedCategories.includes(productCategory))
                    ) {
                        $(this).show();
                    }
                });
            } else {
                // If no filters selected, show all products
                initialProducts.show();
            }
        }
    });
    </script>
    



  <script>

      function addToCart(id) {
          // Check if the button has the 'disabled' class
          if ($(`#addToCartBtn_${id}`).hasClass('disabled')) {
              // If it has, the button is disabled, so you can display a message or take other actions
              console.log('Product already in the cart');
              return;
          }
  
          // Add the 'disabled' class to the button to disable it
          $(`#addToCartBtn_${id}`).addClass('disabled');
  
          $.ajax({
              url: "/addTocart",
              method: "post",
              data: {
                  id: id
              },
          }).done((data) => {
              if (data.success) {
                  // Product added successfully
                  Swal.fire({
                      position: 'center',
                      icon: 'success',
                      title: 'Item has been added to Cart',
                      showConfirmButton: false,
                      timer: 1000
                  });
              } else {
                  // Failed to add the product
                  Swal.fire({
                      position: 'center',
                      icon: 'error',
                      title: 'Failed to add the product',
                      showConfirmButton: false,
                      timer: 1500
                  });
  
                  // Remove the 'disabled' class to re-enable the button for future attempts
                  $(`#addToCartBtn_${id}`).removeClass('disabled');
              }
          });
      }
  </script>
  

